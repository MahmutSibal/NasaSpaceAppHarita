import{_ as ee,r as u,J as ae,o as te,K as ne,e as ie,x as M,z as l,L as re,M as se,N as oe,O as f,P as le,Q as ce,R as ue,S as de,T as he,y as S,U as fe,A as me}from"#entry";const ye=globalThis.setInterval,ve={class:"page"},pe={class:"map-container"},we={class:"chat-panel"},ge=["innerHTML"],ke={class:"message-time"},be={class:"chat-input"},Ce=["placeholder","disabled"],Te=["disabled"],T="metric",_e={__name:"index",setup(ze){const _=u(null),b=u(null);let C=null,o=null;const p=u(""),I=u([]),g=u(!1);let $=0;const h=u("city"),d=u(null);u(!0);const A=u(null),B=u(0),F=ae({lat:0,lng:0}),c=u([]);function n(e,t="system"){const a={id:$++,text:e,type:t,time:new Date().toLocaleTimeString()};I.value.push(a),he(()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)})}async function E(e){try{let t=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=3&addressdetails=1&accept-language=tr,en`,a=await fetch(t);if(!a.ok)throw new Error("Geocoding failed");let i=await a.json();if(i.length===0){const r=`${e}, Turkey`;t=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}&limit=3&addressdetails=1&accept-language=tr,en`,a=await fetch(t),a.ok&&(i=await a.json())}if(i.length===0){const r={diyarbakir:"Diyarbakır",izmir:"İzmir",ankara:"Ankara",istanbul:"İstanbul",antalya:"Antalya",bursa:"Bursa",adana:"Adana",konya:"Konya",gaziantep:"Gaziantep",mersin:"Mersin"},y=e.toLowerCase(),w=r[y];w&&(t=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(w+", Turkey")}&limit=3&addressdetails=1&accept-language=tr,en`,a=await fetch(t),a.ok&&(i=await a.json()))}if(i.length===0)return null;const s=i.find(r=>r.address?.city||r.address?.town||r.address?.municipality||r.type==="city"||r.type==="town"||r.type==="administrative")||i[0];return{lat:parseFloat(s.lat),lng:parseFloat(s.lon),name:s.display_name,city:s.address?.city||s.address?.town||s.address?.village||s.address?.municipality,country:s.address?.country}}catch(t){return console.error("Geocoding error:",t),null}}function W(){try{const e=localStorage.getItem("favoriteCities");e&&(c.value=JSON.parse(e))}catch(e){console.error("Error loading favorite cities:",e),c.value=[]}}function j(){try{localStorage.setItem("favoriteCities",JSON.stringify(c.value))}catch(e){console.error("Error saving favorite cities:",e)}}function O(e){c.value.find(t=>t.name===e.name)?n(`${e.name} zaten favorilerinizde bulunuyor.`,"info"):(c.value.push({name:e.name,lat:e.lat,lng:e.lng,city:e.city,country:e.country}),j(),n(`${e.name} favorilere eklendi!`,"success"))}async function N(e,t){try{const a=await fetch("http://localhost:8000/weather",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:e,longitude:t,units:T})});if(!a.ok)throw new Error("API request failed");return await a.json()}catch(a){return console.error("Backend API error:",a),null}}async function H(e,t,a){try{const i=await fetch("http://localhost:8000/chat/weather",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:e,longitude:t,units:T,message:a})});if(!i.ok)throw new Error("Chat API request failed");return await i.json()}catch(i){return console.error("Chat API error:",i),null}}async function Q(e,t){try{const a=await fetch("http://localhost:8000/forecast/weekly",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:e,longitude:t,units:T})});if(!a.ok)throw new Error("Weekly forecast request failed");return await a.json()}catch(a){return console.error("Weekly forecast API error:",a),null}}async function D(e,t){try{const a=await fetch("http://localhost:8000/forecast/tomorrow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({latitude:e,longitude:t,units:T})});if(!a.ok)throw new Error("Tomorrow forecast request failed");return await a.json()}catch(a){return console.error("Tomorrow forecast API error:",a),null}}function x(e){const t=e.toLowerCase(),a=/\b(hafta|week|7\s*g[üu]n|bu\s*hafta|haftal[ıi]k)\b/i.test(t),i=/\b(yar[ıi]n|tomorrow)\b/i.test(t),s=/\b(saatlik|hourly|saat\s*saat|24\s*saat)\b/i.test(t),r=/\b(bug[üu]n|today|şimdi|şu\s*an)\b/i.test(t),y=/\b(bu\s*hafta|this\s*week)\b/i.test(t),w=/\b(şu\s*an|şimdi|now|current|mevcut)\b/i.test(t),Y=/\b(favorilere\s*ekle|add\s*favorite|fav\s*ekle)\b/i.test(t),G=/\b(favorilerim|favoriler|favorites|favs|favorite\s*list)\b/i.test(t),Z=/\b(favorilerden\s*çıkar|remove\s*favorite|fav\s*sil)\b/i.test(t),q=["hava","sıcaklık","yağmur","kar","rüzgar","bugün","weather","derece","soğuk","sıcak","nasıl","durum","kaç","nem","basınç","uv","yağar","yağış","tahmin"].some(z=>t.includes(z)),X=[/(\w+(?:\s+\w+)*?)(?:\s*(?:'?da|'?de|'?ta|'?te))?\s+(?:bu\s+hafta|hafta|haftalık|hava|weather|sıcaklık|derece|yağmur|yağar)/i,/^(\w+(?:\s+\w+)*?)\s+(?:haftalık|hafta|hava|weather|sıcaklık|derece)/i,/(\w+(?:\s+\w+)*?)\s*(?:'?da|'?de|'?ta|'?te)\s+(?:hava|kaç|sıcaklık|derece|yağmur|nasıl)/i,/(\w+(?:\s+\w+)*?)\s*(?:'?ta|'?te|'?da|'?de|hava|weather|sıcaklık|derece)/i,/(?:weather\s+in\s+|hava\s+.*?)\s*(\w+(?:\s+\w+)*)/i,/^(\w+(?:\s+\w+)*?)\s+(?:hava|weather|sıcaklık|derece|nasıl|hafta|yağmur|yağar)/i];let R=null;for(const z of X){const L=t.match(z);if(L&&L[1]){let v=L[1].trim();if(v=v.replace(/'?(ta|te|da|de|nın|nin|nun|nün)$/i,""),v=v.replace(/\b(bu|şu|this|that)\s+/i,""),v.length>2&&!["bu","şu","bu hafta","hafta"].includes(v.toLowerCase())){R=v;break}}}return{isWeatherQuestion:q,isWeeklyForecast:a,isTomorrowQuery:i,isHourlyQuery:s,isTodayQuery:r,isThisWeekQuery:y,isCurrentQuery:w,isAddFavoriteCommand:Y,isListFavoritesCommand:G,isRemoveFavoriteCommand:Z,extractedLocation:R}}async function P(){const e=p.value.trim();!e||g.value||(n(e,"user"),p.value="",g.value=!0,h.value==="city"?await J(e):h.value==="question"&&await V(e),g.value=!1)}async function J(e){if(x(e).isListFavoritesCommand){if(c.value.length===0)n("Henüz favori şehriniz bulunmuyor.","info");else{let r=`FAVORI ŞEHIRLER:

`;c.value.forEach((y,w)=>{r+=`${w+1}. ${y.city||y.name} (${y.country||"Ülke bilgisi yok"})
`}),r+=`
Bir şehir seçmek için numarasını yazın!`,n(r.replace(/\n/g,"<br>"),"info")}return}const a=parseInt(e)-1;if(!isNaN(a)&&a>=0&&a<c.value.length){const r=c.value[a];d.value=r,o&&(o.flyTo([r.lat,r.lng],10),await m()),n(`${r.city||r.name} seçildi!`,"success"),n("Bu şehir için ne öğrenmek istiyorsunuz?","info"),n('Örnek sorular: "bugün hava nasıl", "haftalık tahmin", "yarın yağmur var mı", "sıcaklık kaç derece"',"info"),h.value="question";return}const i=c.value.find(r=>r.city?.toLowerCase().includes(e.toLowerCase())||r.name?.toLowerCase().includes(e.toLowerCase()));if(i){d.value=i,o&&(o.flyTo([i.lat,i.lng],10),await m()),n(`${i.city||i.name} seçildi!`,"success"),n("Bu şehir için ne öğrenmek istiyorsunuz?","info"),n('Örnek sorular: "bugün hava nasıl", "haftalık tahmin", "yarın yağmur var mı", "sıcaklık kaç derece"',"info"),h.value="question";return}n(`"${e}" şehri aranıyor...`,"loading");const s=await E(e);s?(d.value=s,o&&(o.flyTo([s.lat,s.lng],10),await m()),n(`${s.city||s.name} şehri bulundu ve seçildi!`,"success"),c.value.find(r=>r.name===s.name)||(n('Bu şehri favorilerinize eklemek için "favorilere ekle" yazın.',"info"),window.lastFoundLocation=s),n("Bu şehir için ne öğrenmek istiyorsunuz?","info"),n('Örnek sorular: "bugün hava nasıl", "haftalık tahmin", "yarın yağmur var mı", "sıcaklık kaç derece"',"info"),h.value="question"):(n(`"${e}" şehri bulunamadı.`,"error"),n("Lütfen farklı bir şehir adı deneyin. Örnek: İstanbul, Diyarbakır, Paris, New York","info"))}async function V(e){if(!d.value){n("Önce bir şehir seçmelisiniz.","error"),h.value="city";return}const t=x(e);if(t.isAddFavoriteCommand){window.lastFoundLocation?(O(window.lastFoundLocation),window.lastFoundLocation=null):d.value&&O(d.value);return}if(e.toLowerCase().includes("yeni şehir")||e.toLowerCase().includes("şehir değiştir")||e.toLowerCase().includes("başka şehir")){n("Yeni şehir seçimi için hangi şehri istiyorsunuz?","info"),h.value="city",d.value=null;return}const a=d.value;if(t.isWeeklyForecast){n(`${a.city||a.name} için 7 günlük tahmin getiriliyor...`,"loading");const i=await Q(a.lat,a.lng);i?n(i.forecast.replace(/\n/g,"<br>"),"weather"):n("Haftalık tahmin şu anda alınamıyor.","error")}else if(t.isTomorrowQuery){n(`${a.city||a.name} için yarın hava tahmini getiriliyor...`,"loading");const i=await D(a.lat,a.lng);i?n(i.forecast.replace(/\n/g,"<br>"),"weather"):n("Yarın hava tahmini şu anda alınamıyor.","error")}else{n(`${a.city||a.name} için hava durumu bilgileri getiriliyor...`,"loading");const i=await H(a.lat,a.lng,e);i?n(i.response.replace(/\n/g,"<br>"),"weather"):n("Hava durumu verileri şu anda alınamıyor.","error")}n('Başka bir soru sormak ister misiniz? Veya "yeni şehir" yazarak farklı bir şehir seçebilirsiniz.',"info")}async function m(){if(!o)return;const e=o.getCenter();F.lat=e.lat,F.lng=e.lng;const t=await N(e.lat,e.lng);t&&(A.value=t,B.value=Date.now())}function K(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:a}=e.coords;o&&(o.flyTo([t,a],8),m())})}let k;function U(){k&&clearInterval(k),k=ye(m,6e4*10)}return te(async()=>{if(C=(await ne(()=>import("./7ah4FPQk.js").then(a=>a.l),[],import.meta.url)).default,!_.value)return;o=C.map(_.value,{center:[20,0],zoom:2,worldCopyJump:!1,maxBounds:[[-60,-180],[85,180]],maxBoundsViscosity:1,minZoom:1,maxZoom:18}),C.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{attribution:"&copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)",noWrap:!0}).addTo(o),C.control.scale({metric:!0,imperial:!0}).addTo(o),o.on("moveend zoomend",()=>{m()}),await m(),U(),W(),n("COSMOSTORM Weather Intelligence System","system"),n("Hangi şehrin hava durumunu öğrenmek istiyorsunuz?","info"),c.value.length>0&&n('Favori şehirlerinizi görmek için "favorilerim" yazın.',"info"),n("Şehir örnekleri: İstanbul, Diyarbakır, Paris, New York, Tokyo...","info")}),ie(()=>{o&&(o.remove(),o=null),k&&clearInterval(k)}),(e,t)=>(S(),M("div",ve,[l("div",pe,[l("div",{id:"map",ref_key:"mapEl",ref:_},null,512),l("button",{class:"locate-btn-overlay",onClick:K,title:"Mevcut konumumu bul"},[...t[1]||(t[1]=[l("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"currentColor"},[l("circle",{cx:"12",cy:"12",r:"3"}),l("path",{d:"M12 1v4m0 14v4M1 12h4m14 0h4"})],-1)])])]),l("div",we,[t[3]||(t[3]=re('<div class="chat-header" data-v-1b359a6e><div class="header-info" data-v-1b359a6e><h2 class="panel-title" data-v-1b359a6e>COSMOSTORM</h2><div class="status-indicator active" data-v-1b359a6e></div></div><div class="panel-subtitle" data-v-1b359a6e>Weather Intelligence</div></div>',1)),l("div",{class:"chat-messages",ref_key:"chatMessagesEl",ref:b},[(S(!0),M(se,null,oe(f(I),a=>(S(),M("div",{key:a.id,class:fe(["message",a.type])},[l("div",{class:"message-content",innerHTML:a.text},null,8,ge),l("div",ke,me(a.time),1)],2))),128))],512),l("div",be,[le(l("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>de(p)?p.value=a:null),onKeyup:ue(P,["enter"]),placeholder:f(h)==="city"?"Hangi şehir? (örn: İstanbul, Diyarbakır, Paris)":`${f(d)?.name||f(d)?.city} için ne öğrenmek istiyorsunuz? (örn: bugün hava, haftalık tahmin, yarın yağmur var mı)`,disabled:f(g),class:"input-field"},null,40,Ce),[[ce,f(p)]]),l("button",{onClick:P,disabled:f(g)||!f(p).trim(),class:"send-btn"},[...t[2]||(t[2]=[l("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor"},[l("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})],-1)])],8,Te)])])]))}},Se=ee(_e,[["__scopeId","data-v-1b359a6e"]]);export{Se as default};
